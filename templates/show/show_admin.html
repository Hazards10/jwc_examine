<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../../static/assets/css/bootstrap.min.css">
    <script src="../../static/assets/js/jquery-3.3.1.min.js"></script>
    <script src="../../static/assets/js/dataTables/jquery.dataTables.js"></script>
    <script src="../../static/assets/js/dataTables/dataTables.bootstrap.js"></script>
    <script src="../../static/assets/js/bootstrap.min.js"></script>
</head>
<body class="frame_body">
  <div class="row">
        <div class="col-md-12">
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                                data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="#">用户管理</a>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
{#                        <ul class="nav navbar-nav">#}
{#                            <li class="dropdown">#}
{#                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"#}
{#                                   aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-filter" aria-hidden="true" style="margin-: 2px 5px 0px 0px"></span>过滤器 </a>#}
{#                                <ul class="dropdown-menu">#}
{#                                    <li><a href="#">Action</a></li>#}
{#                                    <li><a href="#">Another action</a></li>#}
{#                                    <li><a href="#">Something else here</a></li>#}
{#                                    <li role="separator" class="divider"></li>#}
{#                                    <li><a href="#">Separated link</a></li>#}
{#                                    <li role="separator" class="divider"></li>#}
{#                                    <li><a href="#">One more separated link</a></li>#}
{#                                </ul>#}
{#                            </li>#}
{#                        </ul>#}
{#                        <form class="navbar-form navbar-left">#}
{#                            <div class="form-group">#}
{#                                <input type="text" class="form-control" placeholder="Search">#}
{#                            </div>#}
{#                            <button type="submit" class="btn btn-default">搜索</button>#}
{#                        </form>#}
                        <div class="navbar-btn pull-right hide-xs">
                            <a href="/add_admin_router/" class="btn btn-primary" target="main"><span class="glyphicon glyphicon-plus" aria-hidden="true" style="margin-right: 5px"></span>添加账号</a>
                        </div>
                    </div><!-- /.navbar-collapse -->
                </div><!-- /.container-fluid -->
            </nav>
        </div>
    </div>

    <!-- /. ROW  -->
    <!-- 用户表格 -->
    <div class="row">
        <div class="col-md-12">
            <!-- Advanced Tables -->
            <div class="panel panel-default">
                <div class="panel-body">
                    <style>
                        .dataTable th {
                            white-space: nowrap !important;
                        }

                        .div_full_private {
                            width: 100%;
                        }
                        .xftb table tbody th:first-child td:first-child {
                            width: 400px;
                        }
                    </style>
                    <table class="table table-striped table-bordered table-hover div_full_private xftb" id="dataTables-example">
                        <thead>
                            <tr>
{#                                <td class="action-checkbox" style="width: 42px">#}
{#                                    <input type="checkbox" name="_selected_action" value="6" class="action-select" style="width: 20px; height: 20px">#}
{#                                </td>#}
                                <th>序号</th>
                                <th>用户等级</th>
                                <th>姓名</th>
                                <th>工号</th>
                                <th>所属单位</th>
                                <th>账号添加时间</th>
                                <th id="ID">数据库中的ID</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <!--End Advanced Tables -->
        </div>
    </div>
    <!-- 用户表格结束-->
    <!--选中-->
  <div class="row">
      <div class="col-md-12" style="margin-top: 13px">
          <div class="form-actions well well-sm">
              <form action="/delete_admin/" method="post" id="form">
                  <input type="hidden" id="select_array" name="delete_array" value=""/>
                  <div class="btn-group clearfix dropup">
                      <a class="dropdown-toggle btn btn-success" data-toggle="dropdown" href="#">
                          <i class="fa fa-wrench"></i>
                          <span class="action-counter">单击行后操作</span>
                          <span class="all" style="display: none;">选中了 3 个</span>
                          <span class="caret"></span></a>
                      <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                          <li><a onclick="delect_user()"><i class="fa fa-times"></i> 删除所选的 用户</a></li>
                      </ul>
                  </div>
              </form>
          </div>
      </div>
  </div>
  <script>
        var final_data;
        $(document).ready(function () {
            //获取用户列表
            $.ajax({
                type: 'POST',
                url: "/get_admin_all/",
                "async": false,
                dataType: "json",
                success: function (data) {
                    final_data = data;
                    console.log(final_data);
                }
            });
            for (var i = 0; i < final_data.length; i++) {
                final_data[i]['index'] = i+1;
            }
            //console.log(final_data);
            // 显示用户列表
            var table = $('#dataTables-example').DataTable({
                "data": final_data,
                "columns": [ //返回的json数据在这里填充，注意一定要与上面的<th>数量对应，否则排版出现扭曲
                    {
                        "data": "index"
                    },
                    {
                        "data": "admin_rank"
                    },
                    {
                        "data": "admin_name"
                    },
                    {
                        "data": "admin_teacherNo"
                    },
                    {
                        "data": "admin_unit"
                    },
                    {
                        "data": "add_time"
                    },
                    {
                        "data": "admin_id"
                    },
                ],
            });
            // 选中切换
            $('#dataTables-example tbody').on('click', 'tr', function () {
                // 切换选中行样式
                $(this).toggleClass('success');
            });
        });
        function delect_user() {
            var select_arr = [];
            //  获取要删除的字段数据ID
            $(".success").each(
                function () {
                    //将数据库ID添加到删除列表
                    select_arr.push($(this).children(":last").text())
                }
            );
            //console.log(select_arr);
            if (select_arr.length == 0) {
                alert("您没有选中要删除的用户！");
            }
            else {
                //提交表单
                var length = select_arr.length;
                if(confirm("确认要删除选中的"+length+"个用户吗？")){
                    $("#select_array").val(select_arr);
                    $("#form").submit();
                }
                //console.log(select_arr);
            }
        }
    </script>
    <script type="text/javascript">
        {{script}} ('{{wrong}}')
    </script>
</body>
</html>